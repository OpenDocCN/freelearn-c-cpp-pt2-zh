# 十七、答案

# 第一章

1.  你为什么要关心软件架构？
    *   体系结构允许您实现和维护软件的必要质量。注意和关心它可以防止项目出现意外的架构，从而失去质量，还可以防止软件衰减。
2.  架构师应该是敏捷团队中的最终决策者吗？
    *   不。敏捷是为了赋予整个团队权力。建筑师将他们的经验和知识带到桌面上，但是如果一个决定必须被整个团队接受，团队应该拥有它，而不仅仅是建筑师。考虑利益相关者的需求在这里也非常重要。
3.  **单一责任原则** (**SRP**) 与凝聚力有何关系？
    *   遵循 SRP 会带来更好的凝聚力。如果一个组件开始承担多个责任，通常它的凝聚力就会降低。在这种情况下，最好将其重构为多个组件，每个组件都有单一的责任。通过这种方式，我们增加了凝聚力，因此代码变得更易于理解，开发和维护。
4.  在项目生命周期的哪些阶段可以从拥有建筑师中受益？
    *   建筑师可以为项目带来价值，从项目开始到项目进行维护。在项目开发的早期阶段可以实现最大的价值，因为这是关于项目外观的关键决策。然而，这并不意味着建筑师在开发过程中不能有价值。他们可以使项目保持在正确的轨道上。通过协助决策和监督项目，他们确保代码不会以偶然的架构结束，也不会受到软件衰减的影响。

5.  遵循 SRP 有什么好处？
    *   遵循 SRP 的代码更易于理解和维护。这也意味着它的 bug 较少。

# 第二章

1.  RESTful 服务的特点是什么？
    *   显然，REST api 的使用。
    *   无国籍状态-每个请求都包含其处理所需的所有数据。请记住，这并不意味着 RESTful 服务不能使用数据库，恰恰相反。
    *   使用 cookies 而不是保持会话。
2.  您可以使用什么工具包来帮助您创建弹性分布式架构？
    *   Netflix 的猿猴军。
3.  您应该为您的微服务使用集中存储吗？为什么/为什么不呢？
    *   微服务应该使用分散存储。每个微服务都应该选择最适合它的存储类型，因为这会提高效率和可伸缩性。
4.  什么时候应该编写有状态服务而不是无状态服务？
    *   只有在没有无状态的情况下，您才不需要扩展。例如，当客户端和服务必须保持其状态同步时，或者要发送的状态将是巨大的。
5.  经纪人与调解人有何不同？
    *   中介在服务之间进行 “中介”，因此它需要知道如何处理每个请求。经纪人只知道将每个请求发送到哪里，因此它是一个轻量级组件。它可用于创建发布者-订阅者 (pub-sub) 体系结构。
6.  N 层和 N 层体系结构有什么区别？
    *   图层是合乎逻辑的，并指定如何组织代码。层是物理的，并指定您如何运行代码。每个层都必须由其他层分开，要么在不同的进程中运行，要么在不同的机器上运行。

7.  您应该如何用基于微服务的体系结构替换整体？
    *   增量。从整体上雕刻出小的微服务。您可以使用*第 4 章，体系结构和系统设计*中描述的扼杀器模式来帮助您。

# 第三章

1.  什么是质量属性？
    *   一个系统可能具有的特征或品质。通常被称为 “设施”，因为他们中的许多人的名字中都有这个后缀，例如可移植性。
2.  收集需求时应该使用哪些来源？
    *   系统的上下文，现有文档以及系统的利益相关者。
3.  您应该如何判断需求在架构上是否重要？
    *   **A****实际需求** (**A****SRs**) 经常需要单独的软件组件，影响系统的很大一部分，很难实现，和/或强迫你做出权衡。
4.  您应该如何以图形方式记录各方可能对您的系统的功能要求？
    *   准备用例图。
5.  开发视图文档什么时候有用？
    *   如果您正在开发具有许多模块的大型系统，并且需要向所有软件团队传达全局约束和通用设计选择。
6.  您应该如何自动检查代码的 API 文档是否过期？
    *   Doxygen 具有内置的检查，例如警告您有关注释中函数签名及其参数之间不匹配的检查。
7.  您应该如何在图上显示给定的操作是由系统的不同组件处理的？
    *   为此使用 UML 交互图之一。序列图是一个很好的选择，尽管通信图在某些情况下也可以很好地。

# 第四章

1.  什么是事件采购？
    *   这是一种架构模式，它依赖于跟踪改变系统状态的事件，而不是跟踪状态*本身*。它带来了诸如更低的延迟、免费的审计日志以及可调试性等好处。
2.  CAP 定理的实际后果是什么？
    *   随着网络分区的发生，如果您想要一个分布式系统，您需要在一致性和可用性之间进行选择。在分区的情况下，您可以返回陈旧的数据、错误或超时的风险。
3.  您可以使用 Netflix 的 Chaos Monkey 做什么？
    *   它可以帮助您为服务的意外停机做好准备。
4.  缓存在哪里可以应用？
    *   根据您的需求，可以在客户端，web 服务器，数据库或应用前面，也可以在潜在客户端附近的主机上。
5.  当整个数据中心发生故障时，您应该如何防止您的应用出现故障？
    *   通过使用 geodes。
6.  为什么要使用 API 网关？
    *   为了简化客户端代码，因为它不需要对服务实例的地址进行硬编码。
7.  Envoy 如何帮助您实现各种建筑目标？
    *   它通过提供背压、断路、自动重试和异常检测来帮助您的系统容错。
    *   它通过允许金丝雀释放和蓝绿色部署来提高可部署性。
    *   它还提供负载平衡、跟踪、监控和度量。

# 第五章

1.  您应该如何确保我们的代码中打开的每个文件在不再使用时将被关闭？
    *   通过使用 RAII 成语; 例如，通过使用`std::unique_ptr`，它将在其析构函数中关闭它。

2.  什么时候应该在 C 代码中使用 “裸” 指针？
    *   仅传递可选 (可为空) 引用。
3.  什么是扣分指南？
    *   告诉编译器应该为模板推导哪些参数的方法。它们可以是隐式的，也可以是用户定义的。
4.  什么时候应该使用`std::optional`，什么时候应该使用`gsl::not_null`？
    *   前者适用于我们想要传递包含的值的情况。后者只是将指针传递给它。而且，前者可以为空，而后者将始终指向一个对象。
5.  范围算法与视图有何不同？
    *   算法是渴望的，而视图是懒惰的。算法还允许使用投影。
6.  在定义函数时，您应该如何约束您的类型，而不仅仅是通过指定概念名称？
    *   通过使用`requires`子句。
7.  `import X`与`import <X>`有何不同？
    *   后者允许从导入的`X`头中的宏可见。

# 第六章

1.  三、五、零的规则是什么？
    *   编写具有毫不奇怪的语义和更少错误的类型的最佳实践。
2.  你应该什么时候使用尼博洛伊斯和隐藏的朋友？
    *   Niebloids “禁用” ADL，而隐藏的朋友则依靠它来找到。前者因此可以加快编译速度 (需要考虑的重载更少)，而后者可以帮助您实现定制点。
3.  如何改进`Array`界面以使其更易于生产？
    *   `begin`，`end`，以及它们的常量和反向等价物应该被添加，这样它就可以像一个合适的容器一样使用。诸如`value_type`，`pointer`和`iterator`之类的特征对于在通用代码中重用它可能很有用。给成员撒上`constexpr`和`noexcept`有助于安全和性能。也缺少`operator[]`的`const`重载。

4.  什么是折叠表情？
    *   在二进制函子上折叠或缩小参数包的表达式。换句话说，将给定操作应用于所有传递的 variadic 模板参数的语句，以便生成单个值 (或`void`)。
5.  什么时候不应该使用静态多态？
    *   当您需要为代码的使用者提供一种在运行时添加更多类型的方法时。
6.  我们如何在眨眼示例中节省更多分配？
    *   通过避免在添加元素时调整向量的大小。

# 第 7 章

1.  在 c 制造中安装和导出目标有什么区别？
    *   导出意味着目标将可用于其他尝试查找我们软件包的项目，即使未安装我们的代码也是如此。C 制造的包注册表可用于存储有关导出目标位置的数据。二进制文件永远不会离开构建目录。安装要求将目标复制到某个地方，如果它不是系统目录，则设置配置文件或目标本身的路径。
2.  你应该如何让你的模板代码编译得更快？
    *   遵循基尔的规则。
3.  你应该如何使用多个编译器与柯南？
    *   使用柯南配置文件。
4.  如果你想用 pre-C 11 GCC ABI 编译你的柯南依赖，你应该怎么做？
    *   将`compiler.libcxx`设置为`libstdc++ `，而不是`libstdc++ 11`。
5.  您应该如何确保在 c 制造中强制执行特定的 C 标准？
    *   通过调用`set_target_properties(our_target PROPERTIES CXX_STANDARD our_required_cxx_standard CXX_STANDARD_REQUIRED YES CXX_EXTENSIONS NO)`。

6.  您应该如何在 c 制造中构建文档并将其与 RPM 软件包一起发货？
    *   创建目标以生成文档，如[第 3 章](https://cdp.packtpub.com/hands_on_software_architecture_with_c__/wp-admin/post.php?post=26&action=edit)，*功能和非功能需求*中所述，将其安装到`CMAKE_INSTALL_DOCDIR`，然后确保路径未在`CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST`变量中指定。

# 第八章

1.  测试金字塔的基层是什么？
    *   单元测试。
2.  有哪些非功能性测试？
    *   性能、耐久性、安全性、可用性、完整性和可用性。
3.  根本原因分析的著名方法叫什么？
    *   5 为什么
4.  是否可以在 C 中测试编译时代码？
    *   是的，例如，使用`static_assert`。
5.  在为具有外部依赖关系的代码编写单元测试时，应该使用什么？
    *   测试双打，如模拟和假货。
6.  单元测试在持续集成/持续部署中的作用是什么？
    *   它们是门控机制的基础，并充当预警功能。
7.  命名一些允许测试基础架构代码的工具。
    *   服务器规格，测试 infra，Goss。
8.  在单元测试中访问类的私有属性和方法是一个好主意吗？
    *   您应该以这样的方式设计类，即您永远不必直接访问它们的私有属性。

# 第九章

1.  在开发过程中，持续集成在哪些方面节省了时间？
    *   它使您可以更早地捕获错误并在它们进入生产之前对其进行修复。
2.  您是否需要单独的工具来实现持续集成和持续部署？
    *   管道通常使用单个工具编写; 多个工具用于实际测试和部署。
3.  什么时候在会议中执行代码审查有意义？
    *   当异步代码审查花费太长时间时。
4.  在持续集成期间，您可以使用哪些工具来评估代码的质量？
    *   测试，静态分析。
5.  谁参与指定 BDD 方案？
    *   开发商，质量保证，企业。
6.  什么时候应该考虑使用不可变的基础设施？你应该什么时候排除它？

    *   它最好与无状态服务或可以使用数据库或网络存储外包存储的服务一起使用。它不适合有状态服务。
7.  您如何描述 Ansible、Packer 和 Terraform 之间的差异？
    *   Ansible 专为现有 VM 的配置管理而设计，Packer 用于构建云 VM 映像，Terraform 用于构建云基础架构 (例如网络，VM 和负载平衡器)。

# 第十章

1.  为什么安全在现代系统中很重要？
    *   现代系统通常连接到网络，因此可能容易受到外部攻击。
2.  与并发相关的一些挑战是什么？
    *   代码更难设计和调试。可能会出现更新问题。
3.  C 核心准则是什么？
    *   记录如何构建 C 系统的最佳实践。

4.  安全编码和防御编码有什么区别？
    *   安全编码为最终用户提供了鲁棒性，而防御性编码为接口使用者提供了鲁棒性。
5.  您应该如何检查您的软件是否包含已知漏洞？
    *   通过使用 CVE 数据库或自动扫描仪，如 OWASP 依赖检查或 Snyk。
6.  静态分析和动态分析有什么区别？
    *   静态分析是在不执行源代码的情况下对其进行的。动态分析需要执行。
7.  静态链接和动态链接有什么区别？
    *   使用静态链接，可执行文件包含运行应用所需的所有代码。通过动态链接，代码的某些部分 (动态库) 在不同的可执行文件之间共享。
8.  如何使用编译器来解决安全问题？
    *   现代编译器包括检查某些缺陷的消毒剂。
9.  如何在持续集成管道中实现安全意识？
    *   通过使用自动工具来扫描漏洞并执行各种静态和动态分析。

# 第 11 章

1.  我们可以从本章的微基准测试的性能结果中学到什么？
    *   事实上，二进制搜索比线性搜索快很多，即使要检查的元素数量不是那么高。这意味着计算复杂性 (也就是大 O) 很重要。可能在你的机器上，即使是在最大的数据集上进行最长的二进制搜索，也仍然比线性搜索的最短搜索要快!
    *   根据您的缓存大小，您可能还注意到，当数据不再适合特定的缓存级别时，增加所需的内存会导致速度变慢。
2.  我们如何遍历多维数组对性能很重要吗？为什么/为什么不呢？
    *   这是至关重要的，因为我们可能会在内存中线性访问数据，CPU 预取器会希望并奖励我们更好的性能，或者跳过内存，从而阻碍我们的性能。

3.  在我们的协程示例中，为什么我们不能在`do_routine_work`函数中创建线程池？
    *   因为终身问题。
4.  我们如何重做我们的协程序示例，以便它使用生成器而不仅仅是任务？
    *   发电机的主体需要`co_yield`。另外，我们池中的线程可能需要使用原子进行同步。

# 第十二章

1.  在面向服务的体系结构中，服务的属性是什么？
    *   它是具有确定结果的业务活动的表示。
    *   它是独立的。
    *   它对用户来说是不透明的。
    *   它可能由其他服务组成
2.  web 服务的一些好处是什么？
    *   它们很容易使用通用工具进行调试，它们可以很好地与防火墙配合使用，并且它们可能会利用现有的基础架构，例如负载平衡，缓存和 cdn。
3.  什么时候微服务不是一个好的选择？
    *   当 RPC 和冗余的成本大于收益时。
4.  消息队列的一些用例是什么？
    *   IPC、交易服务、物联网。
5.  选择 JSON 而不是 XML 有什么好处？
    *   JSON 需要更低的开销，比 XML 越来越受欢迎，而且人类应该更容易阅读。
6.  REST 如何建立在 web 标准上？
    *   它使用 HTTP 动词和 url 作为构建块。
7.  云平台与传统托管有何不同？
    *   云平台提供易于使用的 api，这意味着可以对资源进行编程。

# 第 13 章

1.  微服务如何帮助您更好地使用系统的资源？
    *   仅扩展缺少的资源而不是整个系统更容易。
2.  微服务和巨石如何共存 (在一个不断发展的系统中)？
    *   新功能可能会开发为微服务，而某些功能可能会从 monolith 拆分并外包。
3.  哪些类型的团队从微服务中受益最大？
    *   遵循 DevOps 原则的跨职能自治团队。
4.  为什么在引入微服务时，必须有一个成熟的 DevOps 方法？
    *   测试和部署许多微服务几乎不可能由单独的团队手动完成。
5.  什么是统一日志记录层？
    *   它是用于收集，处理和存储日志的可配置工具。
6.  日志记录和跟踪有什么不同？
    *   日志记录通常是人类可读的，并且专注于操作，而跟踪通常是机器可读的，并且专注于调试。
7.  为什么 REST 不是连接微服务的最佳选择？
    *   例如，与 gRPC 相比，它可能提供更大的开销。
8.  微服务的部署策略是什么？他们每个人的好处是什么？
    *   每个主机的单一服务-更容易将机器调整为工作负载。
    *   每个主机多个服务-更好地利用资源。

# 第 14 章

1.  应用容器与操作系统容器有何不同？
    *   应用容器被设计为托管单个进程，而操作系统容器通常运行 Unix 系统中通常可用的所有进程。
2.  Unix 系统中沙箱环境的一些早期例子是什么？
    *   chroot，BSD 监狱，Solaris 地区。

3.  为什么容器非常适合微服务？
    *   无论底层技术如何，它们都提供了一个统一的接口来运行应用。
4.  容器和虚拟机的主要区别是什么？
    *   容器更轻量级，因为它们不需要虚拟机管理程序、操作系统内核的副本或辅助进程 (如 init 系统或 syslog)。
5.  什么时候应用容器是一个糟糕的选择？
    *   当您想将多进程应用放在单个容器中时。
6.  命名一些用于构建多平台容器映像的工具。
    *   清单-工具，docker buildx
7.  除了 Docker，还有其他一些容器运行时？
    *   波德曼，集装箱，CRI-O。
8.  什么是一些受欢迎的管弦乐队？
    *   Kubernetes, Docker Swarm, Nomad.

# 第 15 章

1.  在云中运行应用和使它们成为云原生应用有什么区别？
    *   云原生设计包含现代技术，如容器和无服务器，打破了对虚拟机的依赖。
2.  您可以在本地运行云原生应用吗？
    *   是的，例如 OpenStack 等解决方案是可能的。
3.  Kubernetes 的最小**高可用** (**HA**) 集群大小是多少？
    *   最小 HA 集群需要控制平面中的三个节点和三个 worker 节点。
4.  哪个 Kubernetes 对象表示允许网络连接的微服务？
    *   服务。

5.  为什么在分布式系统中日志记录不足？
    *   在分布式系统中收集日志并寻找它们之间的相关性是有问题的。分布式跟踪更适合某些用例。
6.  服务网格如何帮助构建安全系统？
    *   服务网格抽象了不同系统之间的连接，从而可以应用加密和审计。
7.  GitOps 如何提高生产率？
    *   它使用熟悉的工具 Git 来处理 CI/CD，而无需编写专用管道。
8.  监控的标准 CNCF 项目是什么？
    *   普罗米修斯。