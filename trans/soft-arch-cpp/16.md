Appendix A

感谢您在软件架构的旅程中走了这么远。我们写这本书的目标是帮助您就应用程序和系统的设计做出明智的决定。到现在为止，在决定是选择 IaaS，PaaS，SaaS 还是 FaaS 时，您应该感到自信。

本书中有很多事情我们甚至没有触及，因为它们很广泛，超出了本书的范围。要么我们对给定主题的经验太少，要么我们认为它太利基了。还有一些我们认为非常重要的领域，但是我们在章节中找不到适合它们的地方。你会在这个附录中找到它们。

# 设计数据存储

现在让我们讨论一下应用程序的存储。首先，让我们决定是否应该使用 SQL，NoSQL 或其他方法。

一个好的经验法则是根据数据库的大小来决定技术。对于小型数据库，例如那些规模永远不会增长到 tb 区域的数据库，使用 SQL 是一种有效的方法。如果您有一个非常小的数据库或想要创建内存缓存，则可以尝试 SQLite。如果您打算使用单个 tb，再次保证大小永远不会超过该大小，那么最好的选择就是使用 NoSQL。在某些情况下，仍然可以使用 sql 数据库，但是由于硬件成本的原因，它很快就会变得昂贵，因为您的主节点需要服务器的野兽。即使这不是问题，您也应该衡量性能是否足以满足您的需求，并为长时间的维护窗口做好准备。在某些情况下，它也可能适合您使用诸如 Citus 之类的技术来运行 SQL 机器集群，而 Citus 本质上是分片的 PostgreSQL。但是，通常，在这种情况下，使用 NoSQL 更便宜，更简单。如果您的数据库大小超过 10 tb，或者您需要实时摄取数据，请考虑使用数据仓库而不是 NoSQL。

## 我应该使用哪种 NoSQL 技术？

这个问题的答案取决于几个因素。这里列出了一些:

*   如果要存储时间序列 (以较小的，规则的间隔保存增量)，那么最好的选择是使用 InfluxDB 或 VictoriaMetrics。
*   如果您需要类似于 SQL 的东西，但可以在没有连接的情况下使用，或者换句话说，如果您计划将数据存储在列中，则可以尝试使用 Apache Cassandra，AWS DynamoDB 或 Google 的 BigTable。
*   如果不是这样，那么您应该考虑您的数据是否是没有架构的文档，例如 JSON 或某种应用程序日志。如果是这种情况，您可以使用 Elasticsearch，它非常适合这种灵活的数据，并提供 RESTful API。您还可以尝试使用 MongoDB，它以**二进制 JSON** (**BSON**) 格式存储数据，并允许 MapReduce。

好的，但是如果您不想存储文档怎么办？然后，您可以选择对象存储，特别是如果您的数据很大。通常，在这种情况下，与云提供商合作是可以的，这意味着使用亚马逊的 S3 或谷歌的云存储或微软的 Blob 存储应该会对您的情况有所帮助。如果你想使用本地的东西，你可以使用 OpenStack 的 Swift 或部署 Ceph。

如果文件存储也不是你要找的，那么也许你的情况只是关于简单的键值数据。使用这样的存储有它的好处，因为它是快速的。这就是为什么使用它构建许多分布式缓存的原因。值得注意的技术包括 Riak，Redis 和 Memcached (最后一个不适合持久化数据)。

除了前面提到的选项，您可以考虑使用基于树的数据库，如 BerkeleyDB。这些数据库基本上是具有类似路径访问的专用键值存储。如果树对您的情况过于限制，您可能会对面向图的数据库 (如 Neo4j 或 OrientDB) 感兴趣。

# 无服务器架构

尽管与云原生设计有关，但无服务器架构本身就是一个热门话题。自从引入 FaaS 或 CaaS 产品 (例如 AWS Lambda，AWS Fargate，Google Cloud Run 和 Azure Functions) 以来，它获得了很多欢迎。

无服务器主要是 PaaS 产品 (例如 Heroku) 的演变。它抽象了基础架构，以便开发人员可以专注于应用程序，而不是基础架构的选择。

与旧的 PaaS 解决方案相比，无服务器的另一个好处是，您不必为不使用的东西付费。您通常不用为给定的服务级别付费，而是使用 serverless 为部署的工作负载的实际执行时间付费。如果您只想每天运行一次给定的代码，则无需为底层服务器支付月费。

虽然我们没有太多关于 serverless 的细节，但它很少与 C ++ 一起使用。说到 FaaS，目前只有 AWS Lambda 支持 C ++ 作为一种可能的语言。由于容器与语言无关，因此您可以将 C 应用程序和函数与 CaaS 产品 (如 AWS Fargate、Azure 容器实例或 Google Cloud Run) 一起使用。

如果您想运行与 C 应用程序一起使用的非 C 辅助代码，则无服务器功能可能仍然与您相关。维护任务和计划的作业非常适合 serverless，它们通常不需要 C 二进制文件的性能或效率。

# 传播与文化

本书的重点是软件体系结构。那么，为什么我们要在一本关于软件的书中提到沟通和文化呢？如果你仔细想想，所有的软件都是由人*为*人写的*。人的方面很普遍，但我们常常不承认这一点。*

作为一名建筑师，你的角色不会是找出解决给定问题的最佳方法。您还必须将建议的解决方案传达给团队成员。通常，您所做的选择将来自以前的对话。

这些都是沟通和团队文化在软件架构中也发挥作用的原因。

在早期的一个章节中，我们已经提到了康威定律。该定律指出，软件系统的体系结构反映了正在研究它的组织。这意味着，建立伟大的产品需要建立伟大的团队和理解心理学。

如果你想成为一名伟大的建筑师，学习人际交往技能可能和学习技术技能一样重要。

# DevOps

我们在本书中多次使用 DevOps (和 DevSecOps) 一词。在我们看来，这个话题值得一些额外的空间。DevOps 是一种构建软件产品的方法，它打破了传统的基于筒仓的开发。

在瀑布模型中，团队彼此独立地在单个工作方面进行操作。开发团队将编写代码，QA 将测试和验证代码，之后将进行安全性和合规性。最终，运营团队将负责维护。团队很少进行交流，即使那样，这通常也是一个非常正式的过程。

有关特定专业领域的知识仅适用于负责给定工作流程的团队。开发人员对质量保证知之甚少，对操作知之甚少。虽然这种设置非常方便，但现代景观需要比瀑布模型提供的更多敏捷性。

这就是为什么提出了一种新的工作模式，该模式鼓励软件产品的不同利益相关者之间进行更多的协作，更好的沟通以及大量的知识共享。虽然 DevOps 指的是将开发人员和运营人员结合在一起，但这意味着让每个人都更加接近。

开发人员甚至在编写第一行代码之前就开始使用质量保证和安全性。操作工程师更熟悉代码库。企业可以轻松地跟踪给定票证的进度，在某些情况下，甚至可以以自助服务的方式进行部署预览。

DevOps 已成为使用 Terraform 或 Kubernetes 等特定工具的代名词。但是 DevOps 绝不等于使用任何特定工具。您的组织可以遵循 DevOps 原则，而无需使用 Terraform 或 Kubernetes，并且可以在不练习 DevOps 的情况下使用 Terraform 和 Kubernetes。

DevOps 的原则之一是，它鼓励改善产品利益相关者之间的信息流。有了这一点，就有可能实现另一个原则: 减少不会给最终产品带来价值的浪费性活动。

当你构建现代系统时，使用现代方法论是值得的。将现有组织迁移到 DevOps 可能需要进行大规模的思维方式转变，因此并非总是可能的。当你开始一个你可以控制的绿地项目时，这是值得追求的。